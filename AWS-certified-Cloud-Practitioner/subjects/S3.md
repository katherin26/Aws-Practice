# **AMAZON S3**

IMPORTANT:

1. Amazon S3 is one of the main building blocks of AWS.
2. It's advertised as "infinitely scaling" storage.
3. Many websites use Amazon S3 as a backbone.
4. Many AWS services uses Amazon S3 as an integration as well.
5. We'll have a step-by-step approach to S3.
6. The CCP exam requires "deeper" knowledge about S3.

**S3 USE CASES**

1. Backup and storage.
2. Disaster Recovery.
3. Archive.
4. Hybrid Cloud Storage.
5. Application Hosting.
6. Media Hosting.
7. Data lakes & big data analytics.
8. Software delivery.
9. Static Website.

**AMAZON S3 OVERVIEW - BUCKETS**

1. Amazon S2 allows people to store objects (files) in "buckets" (directories).
2. Buckets must have a globally unique name (across all regions all accounts).
3. Buckets are defined at the region level.
4. S2 looks like a global service but buckets are created in a region.
5. Naming convention.

   a. No uppercase.
   b. No underscore.
   c. 3-63 characters long.
   d. Not an IP.
   e. Must start with lowercase letter or number.

**AMAZON S3 OVERVIEW - OBJECTS**

1. Objects (files) have a **key**.
2. The **key** is the FULL path:
   a. s3://my-bucket/my_file.txt
   b. s3://my-bucket/my_folder/another_folder/my_file.txt

3. The **key** is composed of prefix + object name
   a. s2://my-bucket/my_folder/another_folder/my_file.txt
4. There's no concept of **"directories"** within buckets (although the UI will trick you to think otherwise).
5. Just **keys** with very long names that contain slashes ("/).

6. Object values are the content of the body:
   a. Max object size is 5TB (5000GB)
   b. If uploading more than 5GB, must use "multi-part upload"

7. Metadata (list of text key / value pairs - system or user metadata).
8. Tags (Unicode key / value pair - up to 10) - useful for security / lifecycle.
9. Version ID (if versioning is enabled).

**S3 HANDS ON**

1. Create a bucket (needs to be a unique name).
2. CHoose a region near to you.

![Drag Racing](images/S3_CREATE.png)

3. UPLOAD OBJECTS

![Drag Racing](images/S3_UPLOAD.png)

4. Click Upload , now the files has been upload.

![Drag Racing](images/S3_UPLOAD_END.png)

5. Click in coffee.jpg ===> YOU CAN SEE THE OBJECT OVERVIEW.

![Drag Racing](images/S3_OBJECTOVERVIEW.png)

**ACTIONS**

NOTE: open object actions = and click in open (You can see the image). ====> **is open into a pre-signed URL** and it contains
the AWS credentials into the URL.
But if we click on bucket url the access is denied because we don't have the right to access the objects. So how come this worked in the second tab but not in the third tab. That's because the bucket is not public.

**CREATE A FOLDER**

![Drag Racing](images/S3_CREATEFOLDER.png)

//NOTE: Now we have the coffee.jpg and the images/ folder.

Inside the folder you can upload files

**S3 SECURITY**

1. User based
   a. IAM Policies - which API calls should be allowed for a specific user from IAM console.
2. Resource Based.
   a. Bucket Policies - bucket wide rules from the S3 console - allows cross account.
   b. Object Access Control List (ACL) - finer grain.
   c. Bucket Access Control List (ACL) - less common.
3. NOTE: an IAM principal can access an S3 object if.
   a. the user IAM Permissions allow it OR the resource policy ALLOWS it.
   b AND there's no explicit DENY.
4. Encryption: encrypt objects in Amazon S3 using encryption keys.

**EXAMPLE: PUBLIC ACCESS - USE BUCKET POLICY**

//IMPORTANT: Probably exam question.

**CASE**

```
        ANONYMOUS WEBSITE VISITOR   ===========>   S3 BUCKET + S3 BUCKET POLICY | ALLOWS PUBLIC ACCESS.
```

We have an S3 bucket and say, we have someone not using your account.
This is anonymous worldwide web website visitor and they want to read the files from your S3 bucketS.
So by default, we saw if we try to read a file using the web browser there was an access denied.

To solve it, we have to attach an S3 bucket policy to our S3 buckets, which is going to allow public access, When this happen our web visitor thanks to the bucket policy, we'll be able to access to files onto our S3 Buckets.

**EXAMPLE: USER ACCESS TO S3 - IAM PERMISSIONS**

//IMPORTANT:

**CASE**

```
        IAM USER + IAM POLICY   ===========>   S3 BUCKET.
```

We can just thanks to the IAM policy allow the IAM user to access our S3 buckets.

**EXAMPLE: EC2 INSTANCE ACCESS - USE IAM ROLES**

**CASE**

```

EC2 INSTANCE ROLE | IAM Permissions

EC2 INSTANCE                        ==============> S3 Bucket.

```

**EXAMPLE: ADVANCED: CROSS-ACCOUNT ACCESS- USE BUCKET POLICY**

**CASE**

```
IAM User Other AWS account       ===================>  S3 Bucket + S3 Bucket policy, Allows Cross-Account.

```

# **S3 BUCKET POLICIES**

![Drag Racing](images/S3_BUCKET_POLICIES.png)

//NOTE: But we cannot use them for public access if we don't disable the security settings .

![Drag Racing](images/S3_BLOCK_PUBLIC_ACCESS.png)

**S3 BUCKET POLICY HANDS**

1.  Go to = permissions.
2.  Create a public bucket policy.
3.  Edit public access (BUCKET SETTINGS).
4.  Edit bucket policy = Policy examples | Policy Generator.
5.  Policy Generator :

    a. AMAZON RESOURCE NAME (ARN) ====> copy and paste the ARN and add (/\*) at the end.

         NOTE: Actions (GetObject)

         This policy allows the S3 GetObject action on this buckets object.

![Drag Racing](images/S3POLICY.png)
